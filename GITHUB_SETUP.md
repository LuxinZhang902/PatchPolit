# ğŸ” GitHub PR Creation Setup

PatchPilot can now create **real GitHub Pull Requests** automatically! Follow these steps to enable this feature.

## ğŸ“‹ Prerequisites

- A GitHub account
- Write access to the repositories you want to fix (or fork them first)

## ğŸš€ Setup Instructions

### Step 1: Create a GitHub Personal Access Token

1. Go to **GitHub Settings** â†’ **Developer settings** â†’ **Personal access tokens** â†’ **Tokens (classic)**
   - Direct link: https://github.com/settings/tokens

2. Click **"Generate new token"** â†’ **"Generate new token (classic)"**

3. Configure the token:
   - **Note**: `PatchPilot PR Creation`
   - **Expiration**: Choose your preferred duration (90 days recommended)
   - **Scopes**: Check the following:
     - âœ… `repo` (Full control of private repositories)
       - This includes: `repo:status`, `repo_deployment`, `public_repo`, `repo:invite`, `security_events`

4. Click **"Generate token"** at the bottom

5. **âš ï¸ IMPORTANT**: Copy the token immediately! You won't be able to see it again.

### Step 2: Add Token to Your Environment

1. Open your `.env` file in the PatchPilot root directory

2. Add the following line:
   ```bash
   GITHUB_TOKEN=ghp_your_token_here
   ```

3. Replace `ghp_your_token_here` with your actual token

### Step 3: Restart the Application

```bash
# Stop the current server (Ctrl+C)
npm run dev
```

## âœ… Verification

To verify the setup is working:

1. Create a new debug session
2. Wait for the patch to be generated
3. Click **"Create Pull Request"**
4. Check the logs - you should see:
   ```
   [timestamp] Pushing branch to GitHub...
   [timestamp] Creating pull request via GitHub API...
   [timestamp] âœ… Pull request created successfully!
   [timestamp] PR #123: https://github.com/owner/repo/pull/123
   ```

## ğŸ”’ Security Best Practices

### Token Security
- âœ… **DO**: Keep your token in `.env` file (already in `.gitignore`)
- âœ… **DO**: Use tokens with minimal required permissions
- âœ… **DO**: Set expiration dates on tokens
- âŒ **DON'T**: Commit tokens to version control
- âŒ **DON'T**: Share tokens publicly
- âŒ **DON'T**: Use tokens in client-side code

### Token Permissions
The `repo` scope is required for:
- Creating branches
- Pushing commits
- Creating pull requests
- Reading repository metadata

### Revoking Tokens
If your token is compromised:
1. Go to https://github.com/settings/tokens
2. Click **"Delete"** next to the compromised token
3. Generate a new token and update your `.env`

## ğŸ› Troubleshooting

### "Failed to create PR: Not Found"
- **Cause**: Repository doesn't exist or you don't have access
- **Solution**: Ensure you have write access or fork the repository first

### "Failed to create PR: Reference already exists"
- **Cause**: Branch `patchpilot-fix` already exists on GitHub
- **Solution**: Delete the branch on GitHub or use a different branch name

### "GITHUB_TOKEN not configured"
- **Cause**: Token not in `.env` file
- **Solution**: Follow Step 2 above

### "Failed to push: Permission denied"
- **Cause**: Token doesn't have `repo` scope
- **Solution**: Regenerate token with correct permissions

### "Failed to push: Authentication failed"
- **Cause**: Token is invalid or expired
- **Solution**: Generate a new token

## ğŸ“Š What Happens Without a Token?

If `GITHUB_TOKEN` is not configured:
- âœ… Patches are still generated
- âœ… Changes are committed locally
- âœ… You get a comparison URL
- âŒ PRs are NOT created automatically
- â„¹ï¸ You'll see instructions for manual PR creation

## ğŸ¯ Example PR

When a PR is created, it includes:
- **Title**: `fix: [Bug description]`
- **Body**: 
  - Bug description
  - Changes made
  - Test command
  - Test status
  - PatchPilot branding

Example:
```markdown
## ğŸ¤– AI-Generated Bug Fix

**Bug Description:**
TypeError when user object is null in getUserName function

**Changes Made:**
This PR contains an AI-generated patch that addresses the issue described above.

**Test Command:**
```bash
npm test
```

âœ… **Tests passed** after applying this patch.

---
*Generated by PatchPilot - AI-powered bug fixing*
```

## ğŸ”„ Workflow

1. User submits bug report
2. Agent analyzes and generates patch
3. Patch committed to `patchpilot-fix` branch locally
4. User clicks "Create Pull Request"
5. **With token**: Branch pushed â†’ PR created automatically
6. **Without token**: User gets manual instructions

## ğŸ“ Notes

- Each session creates a new `patchpilot-fix` branch
- Old branches are overwritten (force push)
- PRs are created against the base branch specified in the session
- The workspace is cleaned up after PR creation

---

**Ready to create real PRs!** ğŸš€ Add your `GITHUB_TOKEN` and start fixing bugs automatically.
